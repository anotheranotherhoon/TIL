# 0. React 컴포넌트의 key 속성에 대해서 설명하라.

* map을 사용하여 컴포넌트를 생성하면 아래와 같은 에러를 마주 할 수 있다. 

<img src="https://github.com/anotheranotherhoon/TIL/blob/master/React/img/component_need_key.png"  width="400" height="100"/>

* 이 경고는 컴포넌트들에게 key를 만들어주지 않았을 때 발생한다. 
* 자식 컴포넌트들은 각자의 고유한 키를 가져야 한다는 의미이다. 따라서 컴포넌트들에게 키를 만들어주면 에러가 사라지게 된다.
```
{shoes.map((el, index) => (<Card shoes={el} key={index} />))}
```

* map을 이용해 컴포넌트를 생성하였을 때 키를 만들어주지 않을 경우 왜 경고가 발생하는 것일까? 컴포넌트와 키에 대하여 알아보자!

## 1. React 공식 문서 [재조정](https://reactjs-kr.firebaseapp.com/docs/reconciliation.html#%EB%8F%99%EA%B8%B0)(Reconciliation)
>* Reconciliation 화해, 조정, reconcile (두 가지 이상의 생각·요구 등을) 조화시키다.
>* 회계에서 조정은 두 개의 레코드 세트가 일치하는지 확인하는 하는 프로세스다. 예를 들어 계정을 떠나는 돈이 실제 지출한 돈과 일치하도록하기 위해 사용된다.

* React는 컴포넌트의 상태(state)나 속성(prop)이 변할 때 마다 render()함수를 호출 하는데, render() 함수는 새로운 React요소 트리를 반환하고  이를 기존의 요소트리와 비교하여 새로운 변경점에 대해서만 렌더링을 수행한다.

## 1.1 React의 비교 알고리즘(Diffing Algorithm)
* 쉽게 말하면 기존의 DOM과 변경된 DOM을 비교하여 바뀐 부분만 새로 렌더링 한다.

## 1.1-1 다른 타입의 요소의 경우
* 루트 요소가 다른 타입을 가질떄마다 React는 오래된 트리를 해체하고 새로운 트리를 처음부터 빌드한다.
* 새 트리가 만들어 질때 이전 트리와 관련한 모든 state가 손실된다.
```
오리지널 트리
<div>
    <Card/>
</div>
후속 트리
<span>
    <Card>
</span>
```
* 따라서 기존의 div태그가 span으로 바뀌면서 자식 요소인 이전 트리의 Card도 제거하고 새로운 것으로 만들어진다.

## 1.1-2 자식 요소의 경우
```
<ul>
    <li>1</li>
    <li>2</li>
</ul>

<ul>
    <li>1</li>
    <li>2</li>
    <li>3</li>
</ul>
```
* DOM 노드의 자식에 대해 반복할 때 React는 두 자식 목록을 반복하여 비교하고 차이가 있을 때마다 변경해준다.
* 위 예제처럼 자식의 끝에 요소를 추가할 경우 맨 끝의 요소만 바뀐것을 알 수 있기 때문에 자식의 끝에 요소를 추가한다.
* 같은 인덱스의 자식들의 값이 같으므로 맨 뒤의 요소만 추가하면 된다 판단한다.
```
<ul>
    <li>1</li>
    <li>2</li>
</ul>

<ul>
    <li>0</>
    <li>1</li>
    <li>2</li>
</ul>
```
* 하지만 위의 예제에서는 같은 인덱스의 자식들의 값이 다르므로 맨 앞의 요소에 0만 된다는것을 React는 판단하지 못한다.
* 따라서 0,1,2자식들을 새로 생성하게 된다.

## 1.2 Keys
* 이러한 문제를 해결하기 위해 React는 key 속성을 지원한다. 
* 자식이 키를 가질 때 React는 오리지널 트리의 자식을 후속 트리의 자식과 비교할 때 키를 사용한다. 

```
<ul>
    <li key="1">1</li>
    <li key="2">2</li>
</ul>

<ul>
    <li key="0">0</li>
    <li key="1">1</li>
    <li key="2">2</li>
</ul>
```
* 자식이 key를 가질 때 React는 오리지널 트리의 자식과 후속 트리의 자식을 비교할 때 키를 이용하여 같은 키 값을 가진 자식들끼리 변화가 발생했는지 비교한다.
* 키를 사용하므로써 React는 1번과 2번키를 가진 자식은 새로 렌더링할 필요가 없으며 단지 옮겨진 것 뿐이고 0번 키를 가지는 새로운 자식을 기존 자식들 앞에 추가하면 된다는 사실을 알아낸다.
---
## 정리

* React 컴포넌트의 상태(state)나 속성(prop)이 변할 때마다 render() 함수를 호출하여 새로운 React요소를 반환하고 기존 요소 트리와 비교하여 변경점에 대해서만 렌더링을 수행하는 데 자식들에게 키를 부여함으로써 같은 키를 가진 자식들끼리만 비교하여 탐색의 효율성을 높여 불필요한 렌더링을 피할 수 있게 한다.

---
## liveSession 모범 답안
* key 속성은 같은 컴포넌트를 여럿 렌더링할 때, 다른 컴포넌트임을 구분하기 위해서 사용하는 속성입니다. 예를 들어, 100개의 게시글 중 하나의 게시글만 변경되었을 때, 해당 게시글만 새롭게 재렌더링하고, 다른 게시글은 그대로 둘 수 있습니다. 이렇게 key 속성을 활용하면 React가 DOM을 직접 제어하는 것 보다 더 빠르게 렌더링을 할 수 있습니다.