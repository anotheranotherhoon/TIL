> 그림으로 쉽게 배우는 운영체제 - 감자님 강의 참조
예전 유니프로그래밍 환경에서 메모리보다 더 큰 프로그램을 실행시키는 방법은 무엇이었을까?

방법은 큰 프로그램을 메모리에 올릴 수 있도록 잘라서 당장 실행시켜야 할 부분만 메모리에 올리고 나머지는 용량이 큰 하드디스크에 저장하는 방식이다.

이 기법을 메모리 메모리 오버레이(memory overlay)라고 한다.

큰 프로그램을 작게 나누어 일부만 실행하고 일부는 하드디스크에 저장된다고 했는데 정확히는 하드디스크의 스왑영역이라는 곳에 저장된다.

만약 메모리에 1GB를 올리고 스왑영역에 8GB올리고 사용한다면 사용자는 메모리가 9GB인 것 처럼 느껴진다.

스왑 : 스왑영역에 있는 데이터 일부를 메모리로 가져오고 메모리에 있는 데이터를 스왑영역으로 옮기는 것

하지만 스왑과정이 있기 때문에 실제 메모리가 9GB인 컴퓨터 보다는 느리게 반응한다.

오늘날과 같이 메모리에 여러 개의 프로세스가 올라오는 멀티 프로그래밍 환경에서는 메모리 관리를 어떻게 할까?

운영체제를 연구하는 사람들은 메모리를 어떤 크기로 나눌까 고민을 했고, 두 가지 방식으로 나눠진다.

첫 번째 방식은 가변 분할 방식이다.
가변 분할 방식은 프로세스의 크기에 따라 메모리를 나누는 방식이다.
프로세스가 크면 메모리도 크게 할당한다.

두 번째 방식은 고정 분할 방식이다.
프로세스의 크기와 상관 없이 메모리를 정해진 크기로 나누는 방식이다.

크기가 5MB인 프로세스가 A있고 2MB인 프로세스 B와 1MB인 프로세스 C가 있다고 가정해보자.

가변 분할 방식은 프로세스의 크기에 따라 메모리를 나누기 때문에 메모리에 프로세스 A를 위한 5MB를 확보하고 프로세스 B를 위한 2MB를 확보하고 프로세스 C를 위한 1MB를 할당한다.

한 프로세스가 메모리에 연속된 공간에 할당되기 때문에 "연속 메모리 할당"이라고 한다.

고정 분할 방식은 프로세스의 크기에 상관없이 메모리를 정해진 크기로 나눈다.

메모리 크기를 2MB로 나눈다고 가정하자.

5MB가 필요한 프로세스 A는 2MB로 나눈 구역 세 개에 나눠서 할당된다.

1MB는 빈공간으로 남는다.

프로세스 B는 2MB이기 때문에 크기가 정확히 맞는다.

프로세스 C는 1MB이지만 2MB를 할당하고 1MB는 빈 공간으로 남는다.

이 방식은 한 프로세스가 메모리에 분산되어 할당 되기 때문에 "비연속 메모리 할당"이라고 한다.

그럼 가변 분할 방식과 고정 분할 방식의 장단점을 알아보자.

가변 분할 방식의 장점은 메모리에 연속된 공간에 할당 되기 때문에 더 크게 할당되서 낭비되는 "내부 단편화"가 없다.

단점으로는 "외부 단편화"가 발생한다.

고정 분할 방식의 장점은 구현이 간단하고 오버헤드가 적다는 것이다.

단점으로는 작은 프로세스도 큰 영역에 할당돼서 공간이 낭비되는 "내부 단편화"가 발생한다.

오늘 날의 운영체제는 가변 분할 방식과 고정 분할 방식을 혼합하여 단점을 줄였다.

가변 분할 방식에서 발생하는 외부 단편화 문제를 알아보자.

메모리에 서로 다른 크기를 가지고 있는 여러 개의 프로세스가 올라왔다고 가정해보자.

처음에는 문제가 없지만 프로세스 A와 C가 빠지고 60MB 프로세스가 메모리에 올라가려고하면 연속된 메모리가 아니기 때문에 올라 갈 수 없다. 이것을 "외부 단편화"라고 한다.

이러한 상황에서 해결 방법은 외부 단편화가 발생한 공간을 합쳐주는 조각모음을 하면 된다.

하지만 조각모음을 하려면 현재 메모리에서 실행되고 있는 프로세스들의 작업을 일시 중지 해야 하고 메모리 공간을 이동시키는 작업을 해야 하기 때문에 오버헤드가 발생한다.

고정 분할 방식에서 발생하는 내부 단편화를 알아보자.

가상 메모리 시스템에서 고정 분할 방식을 "페이징"이라고 한다.

책의 페이지 처럼 크기가 정해져 있다고 해서 붙은 별명이다.

메모리에 서로 다른 크기를 가지고 있는 여러 개의 프로세스가 올라 왔다고 가정해보자.

각각의 프로세스가 20MB의 크기로 쪼개져 메모리에 할당 되었다.

메모리가 부족하기 때문에 프로세스 A의 마지막 10M는 하드디스크 내 스왑영역에 할당되었다.

여기서 프로세스 C와 D의 크기는 분할된 크기 보다 작기 때문에 내부에 빈공간이 생겨 낭비 된다.

이를 내부 단편화라고 하는데 이를 해결하는 방법은 없고 분할되는 크기를 조절해서 내부 단편화를 최소화한다.

그럼 가변 분할 방식과 고정 분할 방식을 혼합해 단점을 최소화한 버디 시스템을 알아보자.

버디 시스템은 2의 승수로 메모리를 분할해 메모리를 할당하는 방식이다.

메모리 크기가 2<sup>11</sup>인 2048바이트라고 가정하자 크기가 500B인 프로세스가 메모리 할당을 원한다.

그럼 먼저 2의 승수로 500바이트 보다 작은 값을 만날 때 까지 나눈다.
세 번을 나누면 256바이트 공간이 나오는데 여기에는 500바이트 프로세스를 할당 할 수 없다.

그래서 512바이트 공간에 프로세스를 할당하면 12바이트의 내부 단편화가 발생한다.

이 프로세스가 사용을 마치고 나가도 근접한 메모리 공간을 합치기 쉽다. 그 이유는 2의 승수로 동일하게 나눠서 반대로 조립만 하면 큰 공간이 만들어지기 때문에 조각 모음보다 훨씬 간단하다.

이 방식의 장점은 가변 분할 방식 처럼 프로세스 크기에 따라 할당되는 메모리 크기가 달라지고 외부 단편화를 방지하기 위헤 메모리 공간을 확보하는 것이 간단하다.

고정분할 방식 처럼 내부 단편화가 발생하지만 그 메모리 수가 적다.






