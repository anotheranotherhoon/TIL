> 참고 : https://d2.naver.com/helloworld/4969726
2022년05월05일

## 웹 폰트란?
개발자가 표현하고 싶은 글꼴을 사용자의 기기에 적용할 수 있도록 필요에 따라 웹에서 다운로드하게 하는 기술입니다.

웹 폰트는 사용자가 폰트를 설치하지 않아도 디자이너가 원하는 타이포그래피를 웹 페이지에 구현할 수 있게 하는 기술입니다.

## 웹 폰트의 문제점
웹폰트를 다운받고 적용하여 텍스트를 렌더링하는 과정이 동기적으로 발생하여. 텍스트들 간에 렌더링 시점이 차이가 나게 된다. 이로 인해 실시간으로 렌더링 되는 문장을 보는 사용자 입장에서 오해 할 수 있는 일으내용으로 문장을 바꿔 렌더링 되는 문제가 발생할 수 있다.

## 문제점의 원인
![](https://github.com/anotheranotherhoon/TIL/blob/master/Web/img/rendering.png?raw=true)

CSSOM(CSS Object Model)을 생성하는 과정이다. 
이 과정에서 외부 웹 폰트 링크로 정의된 부분을 만나고 해당 폰트 파일을 다운로드한다.
하지만 그리기 단계에서 웹 폰트 파일처럼 외부 링크로 연결된 파일의 다운로드가 완료되지 않았으면 브라우저는 해당 자원을 사용하는 콘텐츠의 렌더링을 차단한다.

## 웹 폰트 최적화 방법 1 폰트 파일의 용량 줄이기
웹 폰트는 네트워크를 통해 다운로드하는 자원이기 때문에 파일의 크기가 크면 웹 폰트가 적용된 글자가 화면에 표시될 때까지 시간이 지연되는 문제가 발생한다. 
이러한 문제는 **폰트 파일의 용량을 최적화**해 완화할 수 있다.

## 1-1 WOFF 2.0 형식 폰트
폰트 형식에서 WOFF(Web Open Font Format) 형식과 WOFF 2.0 형식(이하 WOFF2 형식)은 압축된 폰트 형식이다.
같은 계열에 속하는 WOFF 형식과 WOFF2 형식에서는 WOFF2 형식이 30~50% 더 압축된 형식이다.

WOFF2 형식은 Internet Explorer를 제외한 모든 브라우저에서 사용할 수 있다.
그러므로 **Internet Explorer에서는 WOFF 형식을,
나머지 브라우저에서는 WOFF2 형식**을 사용하도록 해서 폰트의 용량을 줄일 수 있다.

## 1-2 서브셋 폰트
서브셋 폰트(subset font)는 폰트 파일에서 **불필요한 글자를 제거**하고 사용할 글자만 남겨둔 폰트다.

[갞, 갡, 갫]과 같은 불필요한 글자를 폰트에서 제거하고 사용할 글자만 남겨 둔 폰트가 서브셋 폰트다. 글자의 개수가 줄었기 때문에 서브셋 폰트는 용량이 작다.

한글 폰트에서 어떤 글자를 삭제할지는 국가 표준(KS)인 "정보 교환용 부호계(한글 및 한자)"를 참고해 판단할 수 있다.

나눔바른고딕 폰트의 용량은 2.4MB였지만, 서브셋 폰트의 용량은 586KB로 줄었다.
최근에 출시되는 한글 웹 폰트의 대부분은 2,350자의 서브셋 폰트다. 

## 1-3 unicode-range 속성

unicode-range 속성은 유니코드로 지정한 글자에만 웹 폰트를 적용하는 속성이다. 다음과 같이 CSS의 @font-face 규칙에 unicode-range 속성을 선언해 사용한다.
<br>
![](https://github.com/anotheranotherhoon/TIL/blob/master/Web/img/unicode_range.png?raw=true)
예에서 U+BC14는 글자 '바'에 해당하는 유니코드고, U+CC28는 글자 '차'에 해당하는 유니코드다. 
전체 텍스트에서 unicode-range 속성에 유니코드로 등록된 글자인 '바'와 '차'에만 웹 폰트가 적용되었다.

unicode-range 속성의 장점은 등록된 글자가 텍스트에 없으면 웹 폰트 다운로드를 요청하지 않는다는 것이다.
즉, 웹 폰트를 사용하지 않으면 불필요한 다운로드를 막을 수 있다.
이렇게 하면 사용자가 웹 페이지를 로딩할 때 폰트 전체를 다운로드하지 않고 웹 페이지에서 사용할 문자에 필요한 폰트만 선택적으로 다운로드한다.
## 웹 폰트 최적화 방법 2 텍스트가 항상 보이게 하기
브라우저는 웹 페이지를 렌더링하는 과정에서 웹 폰트가 다운로드되지 않았으면 해당 텍스트의 렌더링을 차단한다. 렌더링을 차단했을 때의 동작은 브라우저마다 다르다.

브라우저의 렌더링 차단 처리 방식을 살펴보고 텍스트가 보이지 않은 문제를 해결하는 방법을 설명하겠다.


## FOUT 방식의 Internet Explorer 계열 브라우저**
Internet Explorer는 웹 폰트가 로딩될 때까지 우선 폴백 폰트로 텍스트를 렌더링한다. 웹 폰트 로딩이 완료되면 텍스트를 웹 폰트로 전환한다. 이 방식은 웹 폰트 로딩 여부에 관계없이 텍스트가 항상 보이는 장점이 있다. 하지만 글꼴의 자간, 높이 등 서식이 달라 웹 폰트 적용 전과 후에 레이아웃이 변경될 수 있다.<br>

## FOIT 방식의 브라우저**

Firefox와 Chrome 등의 브라우저는 웹 폰트가 로딩되기 전까지 해당 텍스트를 화면에 보여 주지 않는다.
웹 폰트 로딩이 완료되면 텍스트를 웹 폰트로 전환한다. 
한 번에 웹 폰트를 보여줄 수 있다는 장점이 있지만, 웹 폰트의 로딩이 늦으면 빈 텍스트가 노출되는 문제점이 있다.

웹 폰트가 로딩되지 않은 상태로 3초가 지나면 폴백 폰트로 우선 렌더링해서 브라우저 자체적으로 웹 폰트의 로딩 시간이 과도하게 오래 걸리는 상황에 대비한다.<br>
## FOUT 방식을 사용한 최적화**

FOIT 방식은 빈 텍스트가 노출되는 문제가 있기 때문에 UX 관점에서 좋지 않다.
그러므로 모든 브라우저에서 FOIT 방식이 아닌 FOUT 방식으로 작동하게 한다면 텍스트가 보이지 않는 문제를 해결할 수 있다.

의도적으로 FOUT 방식으로 작동하게 하는 방법을 살펴보겠다.
## Font Face Observer 라이브러리
![](https://github.com/anotheranotherhoon/TIL/blob/master/Web/img/font_face_observer.png?raw=true)
CSS에는 웹 폰트를 적용하지 않은 상태와 적용한 상태를 선언해 두고, 적용하지 않은 상태의 CSS가 먼저 적용되도록 한다.

JavaScript에는 사용할 웹 폰트의 이름을 파라미터로 하는 FontFaceObserver 객체를 생성한다. 
이 객체는 웹 폰트의 로딩 상태를 추적하는 객체다. 그리고 load() 메서드를 사용해 웹 폰트의 로딩이 완료되면 CSS 클래스가 추가되도록 한다.

## CSS의 font-display 속성
CSS의 font-display 속성을 사용하면 외부 라이브러리를 사용하지 않아도 웹 폰트의 로딩 상태에 따른 동작을 설정할 수 있다.
font-display 속성은 다음과 같이 auto, block, swap, fallback, optional의 5가지 옵션이 있다

**swap**
swap 옵션은 FOUT와 동일하게 작동하는 옵션이다. 우선 폴백 폰트로 글자를 렌더링하고, 웹 폰트 로딩이 완료되면 웹 폰트를 적용한다. 웹 폰트 로딩 여부와 관계없이 항상 텍스트가 보인다.
텍스트가 항상 보이게 하려면 FOUT와 동일하게 작동하는 **swap** 옵션을 사용한다.


_font-display 속성은 Internet Explorer 계열 브라우저를 제외한 브라우저가 지원한다._ 텍스트가 보이지 않는 문제가 발생하는 브라우저에서는 문제없이 최적화에 font-display 속성을 사용할 수 있다.

## 웹 폰트 최적화 방법 3 Font Style Matcher로 폰트 간 차이 줄이기

의도적으로 FOIT 방식을 FOUT 방식으로 작동하도록 설정해 텍스트가 보이지 않는 문제를 방지했지만 FOUT 방식에도 문제가 있다.

웹 폰트 적용 전후에 레이아웃이 깨져서 보이는 현상이 발생할 수 있다.
심각한 문제는 아니지만 웹 폰트 다운로드가 지연될 때에는 레이아웃이 깨진 듯한 UI를 사용자에게 지속해서 노출하는 문제가 있다.

"Font Face Observer 라이브러리"에서 살펴본 폰트 로더와 함께 Font style matcher 앱을 사용하면 문제를 해결할 수 있다.

## 웹 폰트 최적화 방법 4 preload 옵션으로 먼저 로딩하기
다음과 같이 <link>태그의 rel 속성에 preload 옵션을 사용하면 해당 리소스를 다른 리소스보다 빨리 로딩한다.
주로 폰트 파일, 이미지 파일, 스크립트 파일, 비디오 파일 등 페이지에서 중요도가 높은 자원을 의도적으로 먼저 로딩할 때 preload 옵션을 사용한다.
```
<link rel="preload" href="./nanumGothic.woff2" as="font" type="font/woff2" crossorigin="anonymous"> 
```
또한 preload 옵션으로 다운로드하는 리소스가 많아질수록 처음 렌더링 시간이 늦어진다는 문제가 있다. 그렇기 때문에 현재 페이지에서 중요도가 높고 먼저 렌더링되어야 하는 리소스만 preload 옵션으로 지정하는 것이 좋다.

